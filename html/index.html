<!DOCTYPE html>

<html>
	<head lang="en-US">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="author" content="Neil Coffee, Jean-Pierre Koenig, Shakthi Poornima, Chris Forstall, Roelant Ossewaarde, James Gawley">
		<meta name="keywords" content="intertext, text analysis, classics, university at buffalo, latin">
		<meta name="description" content="Intertext analyzer for Latin texts">

		<link href="/css/style.css" rel="stylesheet" type="text/css"/>
		<link href="/images/favicon.ico" rel="shortcut icon"/>
		
		<script src="/tesserae.js"></script>
		<script src="/jquery.js"></script>
		<script type="text/javascript">
			var is_adv = false

			function toggle_adv() {
				if (is_adv) {
					$(".adv").hide()
					$("#toggle_adv").text("Show advanced")
				}
				else {
					$(".adv").show()
					$("#toggle_adv").text("Hide advanced")
				}
				is_adv = ! is_adv
			}

			function load_results(session) {
				var newform = jQuery("<form />", {
					id: "form_dynamic",
					action: "/cgi-bin/read_bin.pl",
					method: "GET"
				})
						
				var inputelement = jQuery("<input />", {
					type: "text",
					name: "session",
					value: session
				})
				newform.append(inputelement)

				$("#container").append(newform)

				newform.submit()
			}

			function read_table(data) {
				console.log(data)
				$.post("/cgi-bin/read_table.pl", data, function() {
						load_results(data.session)
					})

				init_progress_bar()

				setInterval(function() {update_progress(data.session)}, 1000)
			}

			function launch_search() {
				$.getJSON("/cgi-bin/init_session.pl", {}, function(r) {
					var data = {
						source: $("#sel_source_texts").val(),
						part_source: $("#sel_source_parts").val(),
						target: $("#sel_target_texts").val(),
						part_target: $("#sel_target_parts").val(),
						unit: $("#sel_units").val(),
						feature: $("#sel_features").val(),
						stopwords: $("#sel_stop").val(),
						stbasis: $("#sel_stbasis").val(),
						score: $("#sel_scbasis").val(),
						dist: $("#sel_dist").val(),
						dibasis: $("#sel_dibasis").val(),
						cutoff: $("#sel_cutoff").val(),
						session: r.session
					}
					read_table(data)
				})
			}

			function init_progress_bar() {
				var popup_frame = jQuery("<div />", {id: "cwf_popup_frame"})
				var popup = jQuery("<div />", {id: "cwf_popup"})
				var msg_frame = jQuery("<div />", {id: "cwf_msg_frame"})
				var msg = jQuery("<div />", {id: "cwf_msg"})
				msg.append("<p>Please wait...</p>")
				var pbar_frame = jQuery("<div />", {id: "cwf_pbar_frame"})
				var pbar = jQuery("<progress />", {
					id: "cwf_pbar",
					max: "100",
					value: "0"
				})

				pbar_frame.append(pbar)
				msg_frame.append(msg)
				popup.append(msg_frame)
				popup.append(pbar_frame)
				popup_frame.append(popup)

				$("#container").append(popup_frame)
			}

			function update_progress(session) {
				$.getJSON("/cgi-bin/progress.pl", {session: session}, function(r) {
					$("#cwf_pbar").attr("value", r.progress)
					$("#cwf_msg").html(r.msg)
				})
			}

			function toggle_multi_feature() {
				if ($("#chk_multi_feature").is(":checked")) {
					$("#sel_features").attr("multiple", "multiple")
				} else {
					$("#sel_features").removeAttr("multiple")
				}
			}
		</script>
		
		<style type="text/css">
			.adv { display: none; }
		</style>

		<!--head_insert-->

		<title>Tesserae</title>

	</head>
	<body>

		<div id="container">

			<div id="header"> 
			
			</div>
			<div id="main">
				<h1>Welcome</h1>
		
				<p>
					The Tesserae project aims to provide a flexible and robust web interface for exploring intertextual parallels. 
					Select two poems below to see a list of lines sharing two or more words (regardless of inflectional changes).
				</p>
			<p>
				<span id="toggle_adv" onclick="toggle_adv()">Show advanced</span>
			</p>
	
			<form action="/" method="get" ID="Form1">

				<table class="input">
					<tr class="adv">
						<th>Corpus</th>
						<td>
							<select id="sel_preset" onchange="get_authors('target'); get_authors('source')"></select>
						</td>
					</tr>
					<tr>
						<th>Source:</th>
						<td>
							<select id="sel_source_authors" onchange="get_texts('source');">
							</select><br />
							<select id="sel_source_texts" onchange="get_parts('source');">
							</select><br />
							<select id="sel_source_parts">
							</select>
						</td>
					</tr>
					<tr>
						<th>Target:</th>
						<td>
							<select id="sel_target_authors" onchange="get_texts('target');">
							</select><br />
							<select id="sel_target_texts" onchange="get_parts('target');">
							</select><br />
							<select id="sel_target_parts">
							</select>
						</td>
					</tr>
				</table>

				<div class="adv">
					<table class="input">
						<tr>
							<th>Unit:</th>
							<td>
								<select id="sel_units" name="unit">
								</select>
							</td>
						</tr>
						<tr>
							<th>Feature:</th>
							<td>
								<select id="sel_features" name="feature">
								</select>
								<input type="checkbox" id="chk_multi_feature" onchange="toggle_multi_feature()">allow multiple</input>
							</td>
						</tr>
						<tr>
							<th>Number of stop words:</th>
							<td>
								<select id="sel_stop">
									<option value="0">0</option>
									<option value="10" selected="selected">10</option>
									<option value="20">20</option>
									<option value="30">30</option>
									<option value="40">40</option>
									<option value="50">50</option>
									<option value="100">100</option>
									<option value="150">150</option>
									<option value="200">200</option>
								</select>							
							</td>
						</tr>
						<tr>
							<th>Stoplist basis:</th>
							<td>
								<select id="sel_stbasis">
									<option value="corpus">corpus</option>
									<option value="target">target</option>
										<option value="source">source</option>
									<option value="both" selected="selected">target + source</option>
								</select>
							</td>
						</tr>
						<tr>
								<th>Score basis:</th>
							<td>
								<select id="sel_scbasis">
									<option value="word">word</option>
									<option value="stem">stem</option>
									<option value="feature">feature</option>								
								</select>
							</td>
						</tr>
						<tr>
							<th>Maximum distance:</th>
							<td>
								<select id="sel_dist">
									<option value="999">no max</option>
									<option value="5">5 words</option>
									<option value="10" selected="selected">10 words</option>
									<option value="20">20 words</option>
									<option value="30">30 words</option>
									<option value="40">40 words</option>
									<option value="50">50 words</option>
								</select>							
							</td>
						</tr>
						<tr>
							<th>Distance metric:</th>
							<td>
								<select id="sel_dibasis">
									<option value="span">span</option>
									<option value="span-target">span-target</option>
									<option value="span-source">span-source</option>
									<option value="freq" selected="selected">frequency</option>
									<option value="freq-target">freq-target</option>
									<option value="freq-source">freq-source</option>
								</select>
							</td>
						</tr>
						<tr>
							<th>Drop scores below:</td>
							<td>
								<select id="sel_cutoff">
									<option value="0">no cutoff</option>
									<option value="3">3</option>
									<option value="4">4</option>
									<option value="5">5</option>
									<option value="6">6</option>
									<option value="7" selected="selected">7</option>
									<option value="8">8</option>
									<option value="9">9</option>
								</select>
							</td>
						</tr>
					</table>
				</div>
				<div style="text-align:center; padding:20px;">
					<input type="button" value="Compare Texts" ID="btn_search" onclick="launch_search()" />
				</div>
			</form>
		</div>
		<div id="footer">
		</div>
		</div> <!-- closes container -->
		<script type="text/javascript">
			$.get("header.html", {}, function(data) { $("#header").html(data)})
			$.get("footer.html", {}, function(data) { $("#footer").html(data)})
			init_form()
		</script>
	</body>
</html>


